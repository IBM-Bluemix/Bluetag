!function(e){"use strict";function o(e,o,n,r){var a=6371e3,l=t(n-e),i=t(r-o),c=Math.sin(l/2)*Math.sin(l/2)+Math.cos(t(e))*Math.cos(t(n))*Math.sin(i/2)*Math.sin(i/2),s=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),u=Math.round(a*s*100)/100;return u}function t(e){return e*(Math.PI/180)}var n,r,a=e.querySelector("#app"),l=0,i=0;a.displayInstalledToast=function(){e.querySelector("platinum-sw-cache").disabled||e.querySelector("#caching-complete").show()},a.addEventListener("dom-change",function(){console.log("Our app is ready to rock!"),e.querySelector("get-username").addEventListener("kick",function(t){console.log("App user is "+t.detail.q),r=t.detail.q,n=new WebSocket("ws://bluetaglocation1.mybluemix.net/wsLocationResource"),n.onopen=function(e){console.log("Socket Open: "+JSON.stringify(e))},n.onmessage=function(e){console.log("Server says: "+JSON.stringify(e))},e.querySelector("my-map").addEventListener("locupdate",function(e){if(console.log("Location changed: lat: "+e.detail.lat+" lon: "+e.detail.lon),null!==r){var o={_id:r,longitude:e.detail.lat,latitude:e.detail.lon};console.log("Sending location update over socket: "+JSON.stringify(o)),n.send(JSON.stringify(o))}}),navigator.geolocation.getCurrentPosition(function(o){var t=o.coords.latitude,n=o.coords.longitude;console.log("geting single position to center map once: "+t+" , "+n),e.querySelector("#g-map").latitude=t,e.querySelector("#g-map").longitude=n,e.querySelector("#g-mark").latitude=t,e.querySelector("#g-mark").longitude=n,e.querySelector("#markitlat").innerHTML=t,e.querySelector("#markitlon").innerHTML=n});var a={enableHighAccuracy:!0,timeout:6e4,maximumAge:1e4};navigator.geolocation.watchPosition(function(t){if(!e.querySelector("#onlyupdateonpress").active){var a=t.coords.longitude,c=t.coords.latitude,s=o(c,a,i,l);if(console.log("distance "+s),l=t.coords.longitude,i=t.coords.latitude,console.log("app.js watchpos: "+c+","+a),e.querySelector("#latdiv").innerHTML=c,e.querySelector("#londiv").innerHTML=a,e.querySelector("#distdiv").innerHTML=s,e.querySelector("#g-map").latitude=c,e.querySelector("#g-map").longitude=a,e.querySelector("#g-mark").latitude=c,e.querySelector("#g-mark").longitude=a,e.querySelector("#markitlat").innerHTML=c,e.querySelector("#markitlon").innerHTML=a,null!==r){console.log(r);var u={_id:r,longitude:a,latitude:c};try{console.log("Trying to send through socket: "+JSON.stringify(u)),n.send(JSON.stringify(u))}catch(g){console.log("Failed because: "+g.message),n=new WebSocket("ws://bluetaglocation1.mybluemix.net/wsLocationResource"),n.onopen=function(e){console.log("Socket Open")},n.onmessage=function(e){console.log("Server says: "+JSON.stringify(e))},n.send(JSON.stringify(u))}e.getElementById("taggable").generateRequest()}}},function(e){console.log("Error getting location: "+e.code+" "+e.message),console.log("Error getting location")},a)})}),window.addEventListener("WebComponentsReady",function(){console.log("webcomponents ready"),a.route="splash",e.querySelector("#paperDrawerPanel").closeDrawer()}),addEventListener("paper-header-transform",function(o){var t=e.querySelector("#mainToolbar .app-name"),n=e.querySelector("#mainToolbar .middle-container"),r=(e.querySelector("#mainToolbar .bottom-container"),o.detail),a=r.height-r.condensedHeight,l=Math.min(1,r.y/a),i=.5,c=Math.max(i,(a-r.y)/(a/(1-i))+i);Polymer.Base.transform("translate3d(0,"+100*l+"%,0)",n),Polymer.Base.transform("scale("+c+") translateZ(0)",t)}),a.onDataRouteClick=function(){var o=e.querySelector("#paperDrawerPanel");o.narrow&&o.closeDrawer()},a.singleUpdateLocation=function(){e.querySelector("#onlyupdateonpress").active?(console.log("Single location update"),navigator.geolocation.getCurrentPosition(function(o){var t=o.coords.latitude,a=o.coords.longitude;if(console.log("geting single position to center map once: "+t+" , "+a),e.querySelector("#g-map").latitude=t,e.querySelector("#g-map").longitude=a,e.querySelector("#g-mark").latitude=t,e.querySelector("#g-mark").longitude=a,e.querySelector("#markitlat").innerHTML=t,e.querySelector("#markitlon").innerHTML=a,null!=r){console.log(r);var l={_id:r,longitude:t,latitude:a};try{console.log("Trying to send through socket: "+JSON.stringify(l)),n.send(JSON.stringify(l))}catch(i){console.log("Failed because: "+i.message),n=new WebSocket("ws://bluetaglocation1.mybluemix.net/wsLocationResource"),n.onopen=function(e){console.log("Socket Open")},n.onmessage=function(e){console.log("Server says: "+JSON.stringify(e))},n.send(JSON.stringify(l))}e.getElementById("taggable").generateRequest()}})):(console.log("Pause automatic updates in settings menu to use this"),e.querySelector("#refreshtooltip").playAnimation())},a.scrollPageToTop=function(){e.getElementById("mainContainer").scrollTop=0}}(document);