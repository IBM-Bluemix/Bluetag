!function e(t,o,n){function a(l,c){if(!o[l]){if(!t[l]){var i="function"==typeof require&&require;if(!c&&i)return i(l,!0);if(r)return r(l,!0);var s=new Error("Cannot find module '"+l+"'");throw s.code="MODULE_NOT_FOUND",s}var u=o[l]={exports:{}};t[l][0].call(u.exports,function(e){var o=t[l][1][e];return a(o?o:e)},u,u.exports,e,t,o,n)}return o[l].exports}for(var r="function"==typeof require&&require,l=0;l<n.length;l++)a(n[l]);return a}({1:[function(e,t,o){t.exports={register:"http://bluetagregister1.mybluemix.net/",engine:"http://bluetaggame1.mybluemix.net/",location:"ws://bluetaglocation1.mybluemix.net/",search:"ws://bluetagsearch1.mybluemix.net/",tag:"http://bluetagtag1.mybluemix.net/"}},{}],2:[function(e,t,o){var n=e("../env-config.json");!function(e){"use strict";function t(e,t,n,a){var r=6371e3,l=o(n-e),c=o(a-t),i=Math.sin(l/2)*Math.sin(l/2)+Math.cos(o(e))*Math.cos(o(n))*Math.sin(c/2)*Math.sin(c/2),s=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),u=Math.round(r*s*100)/100;return u}function o(e){return e*(Math.PI/180)}var a,r,l=e.querySelector("#app"),c=0,i=0;l.displayInstalledToast=function(){e.querySelector("platinum-sw-cache").disabled||e.querySelector("#caching-complete").show()},l.addEventListener("dom-change",function(){console.log("Bluetag app.js, adding dom-change event listeners..."),e.querySelector("get-username").addEventListener("kick",function(o){function n(t){var o=t.coords;console.log("one time, getCurrentPosition callback: current position is:"),console.log("Latitude : "+o.latitude),console.log("Longitude: "+o.longitude),console.log("Altitude: "+o.altitude),console.log("More or less "+o.accuracy+" meters.");var n=o.latitude,a=o.longitude;e.querySelector("#latdiv").innerHTML=n,e.querySelector("#londiv").innerHTML=a,e.querySelector("#g-map").latitude=n,e.querySelector("#g-map").longitude=a,e.querySelector("#g-mark").latitude=n,e.querySelector("#g-mark").longitude=a,e.querySelector("#markitlat").innerHTML=n,e.querySelector("#markitlon").innerHTML=a}function s(e){console.warn("ERROR(getCurrentPosition callback: "+e.code+"): "+e.message)}function u(o){var n=o.coords;if(console.log("getWatchPosition callback: current position is lat,lon,alt,accuracy(meters): "+n.latitude+","+n.longitude+","+n.altitude+","+n.accuracy),!e.querySelector("#onlyupdateonpress").active){var s=n.longitude,u=n.latitude,g=t(u,s,i,c);console.log("distance moved: "+g),c=n.longitude,i=n.latitude,e.querySelector("#latdiv").innerHTML=u,e.querySelector("#londiv").innerHTML=s,e.querySelector("#distdiv").innerHTML=g;var d=e.querySelector("#locupdate-center").getAttribute("value");if(console.log("Location changed - recenter map?: "+d),"true"===d&&(e.querySelector("#g-map").latitude=u,e.querySelector("#g-map").longitude=s,e.querySelector("#g-mark").latitude=u,e.querySelector("#g-mark").longitude=s),e.querySelector("#markitlat").innerHTML=u,e.querySelector("#markitlon").innerHTML=s,null!==r){var p={_id:r,longitude:s,latitude:u},m=JSON.stringify(p);console.log("userlocJSON"+m);try{console.log("Trying to send location update over websocket: "+m),1===a.readyState?(console.log("getWatchPosition callback, sending loc update over websocket"),a.send(m)):(console.log("getWatchPosition callback, setTimeout"),setTimeout(function(){console.log("getWatchPosition callback, create new websocket and wait 1s..."),l.openLocationSocket()},1e3),console.log("getWatchPosition callback, sending loc update over websocket"),a.send(m))}catch(y){console.log("getWatchPosition callback websocket request failed because: "+y.message)}e.getElementById("taggable").generateRequest()}}}function g(e){console.warn("ERROR getWatchPosition callback: "+e.code+": "+e.message)}e.querySelector("#searchinput").disabled=!1,console.log("App user is "+o.detail.q),r=o.detail.q,l.openLocationSocket();setInterval(l.locationTimer,6e4);e.querySelector("my-map").addEventListener("locupdate",function(e){if(console.log("Location changed: lat: "+e.detail.lat+" lon: "+e.detail.lon),null!==r){var t={_id:r,longitude:e.detail.lon,latitude:e.detail.lat},o=JSON.stringify(t);console.log("Sending location update over socket: "+o),1===a.readyState?(console.log("my-map.locupdate event handler, sending loc update over websocket"),a.send(o)):(setTimeout(function(){console.log("my-map.locupdate event handler, open websocket, wait 500ms"),l.openLocationSocket()},1e3),console.log("my-map.locupdate event handler, sending loc update over websocket"),a.send(o))}});var d={enableHighAccuracy:!0,timeout:6e4,maximumAge:1e4};navigator.geolocation.getCurrentPosition(n,s,d);navigator.geolocation.watchPosition(u,g,d)}),console.log("Bluetag is ready to rock!")}),window.addEventListener("WebComponentsReady",function(){console.log("webcomponents ready"),l.route="splash",e.querySelector("#paperDrawerPanel").closeDrawer(),e.querySelector("#meta-config").setAttribute("value",JSON.stringify(n));var t=e.querySelector("#meta-config").getAttribute("value");e.querySelector("get-username").url=JSON.parse(t).register+"api/register/",e.querySelector("get-taggable").url=JSON.parse(t).engine,e.querySelector("get-taggable").tagUrl=JSON.parse(t).tag+"api/tag/",e.querySelector("get-tagged").untagUrl=JSON.parse(t).tag+"api/untag/",e.querySelector("get-tagged").url=JSON.parse(t).tag,e.querySelector("get-tagged").findPlayerUrl=(JSON.parse(t).location+"api/getlocation/").replace("ws","http"),e.querySelector("mark-it").urlAddMark=JSON.parse(t).tag+"api/markit/newmark/",e.querySelector("my-places").urlDeleteMark=JSON.parse(t).tag+"api/markit/removemark/",e.querySelector("my-places").url=JSON.parse(t).tag+"api/markit/marked/",e.querySelector("bt-search").url=JSON.parse(t).search+"SearchWS/",e.querySelector("bt-search").tagUrl=JSON.parse(t).tag+"api/tag/",e.querySelector("ws-element").open(),e.querySelector("google-map").addEventListener("google-map-dragstart",function(t){console.log("[app-js] - map dragged, disabling automatic map recenter"),e.querySelector("#locupdate-center").setAttribute("value","false")})}),addEventListener("paper-header-transform",function(t){var o=e.querySelector("#mainToolbar .app-name"),n=e.querySelector("#mainToolbar .middle-container"),a=(e.querySelector("#mainToolbar .bottom-container"),t.detail),r=a.height-a.condensedHeight,l=Math.min(1,a.y/r),c=.5,i=Math.max(c,(r-a.y)/(r/(1-c))+c);Polymer.Base.transform("translate3d(0,"+100*l+"%,0)",n),Polymer.Base.transform("scale("+i+") translateZ(0)",o)}),l.onDataRouteClick=function(){var t=e.querySelector("#paperDrawerPanel");t.narrow&&t.closeDrawer()},l.singleUpdateLocation=function(){console.log("Single location update"),navigator.geolocation.getCurrentPosition(function(t){var o=t.coords.latitude,n=t.coords.longitude;if(console.log("getting single position to center map once: "+o+" , "+n),e.querySelector("#latdiv").innerHTML=o,e.querySelector("#londiv").innerHTML=n,e.querySelector("#g-map").latitude=o,e.querySelector("#g-map").longitude=n,e.querySelector("#g-mark").latitude=o,e.querySelector("#g-mark").longitude=n,e.querySelector("#markitlat").innerHTML=o,e.querySelector("#markitlon").innerHTML=n,null!=r){console.log(r);var c={_id:r,longitude:n,latitude:o};try{console.log("Trying to send through socket: "+JSON.stringify(c)),1===a.readyState?a.send(JSON.stringify(c)):l.openLocationSocket()}catch(i){console.log("Failed because: "+i.message)}e.getElementById("taggable").generateRequest()}},function(e){console.warn("ERROR getWatchPosition callback: "+e.code+": "+e.message)})},l.showSearchMenu=function(){console.log("Show the search menu"),e.querySelector("#search-dropdown").open()},l.openLocationSocket=function(){a=new WebSocket(n.location+"wsLocationResource"),a.onopen=function(e){l.singleUpdateLocation(),console.log("Location service webSocket Open: "+JSON.stringify(e))},a.onmessage=function(e){console.log("Location service webSocket onMessage: "+JSON.stringify(e))},a.onclose=function(e){console.log("Location service websocket onclose: "+JSON.stringify(e)),setTimeout(l.openLocationSocket,5e3)}},l.locationTimer=function(){console.log("ping location socket"),a.send("---ping---")},l.scrollPageToTop=function(){e.getElementById("mainContainer").scrollTop=0},l.goBackToMap=function(){l.route="home"},l.addContactTooltip=function(){l.route="contact"}}(document)},{"../env-config.json":1}]},{},[2]);